<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Transcript - ØªÙØ±ÙŠØº Ù…Ø­ØªÙˆÙ‰ ÙŠÙˆØªÙŠÙˆØ¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="{{ url_for('static', filename='js/pdf-export-new.js') }}" defer></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Tajawal', 'Roboto', sans-serif;
        }
        
        body {
            background: #0f0f0f;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        .youtube-red {
            background: #FF0000;
        }
        
        .youtube-dark {
            background: #282828;
        }
        
        .youtube-darker {
            background: #181818;
        }
        
        .youtube-btn {
            background: #FF0000;
            transition: all 0.2s ease;
        }
        
        .youtube-btn:hover {
            background: #CC0000;
            transform: scale(1.02);
            box-shadow: 0 8px 16px rgba(255, 0, 0, 0.3);
        }
        
        .youtube-btn:active {
            transform: scale(0.98);
        }
        
        .card {
            background: #282828;
            border: 1px solid #3f3f3f;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            border-color: #FF0000;
            box-shadow: 0 4px 20px rgba(255, 0, 0, 0.1);
        }
        
        input {
            background: #121212;
            border: 2px solid #3f3f3f;
            color: #ffffff !important;
            transition: all 0.2s ease;
        }
        
        input:focus {
            outline: none;
            border-color: #FF0000;
            background: #181818;
        }
        
        input::placeholder {
            color: #ffffff;
            opacity: 0.7;
        }
        
        .loading-spinner {
            border: 3px solid #3f3f3f;
            border-top: 3px solid #FF0000;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .badge {
            background: #FF0000;
            color: white;
            padding: 6px 14px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 600;
            display: inline-block;
        }
        
        .section-title {
            color: #ffffff;
            font-weight: 700;
            font-size: 22px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: #FF0000;
            border-radius: 2px;
        }
        
        .content-box {
            background: #181818;
            border-radius: 12px;
            padding: 24px;
            color: #f5f5f5;
            line-height: 2;
            font-size: 15px;
            text-align: justify;
        }
        
        .content-box h4 {
            margin-bottom: 16px;
            font-size: 18px;
        }
        
        .yt-icon {
            width: 80px;
            height: 80px;
            background: #FF0000;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 24px rgba(255, 0, 0, 0.4);
        }
        
        ::-webkit-scrollbar {
            width: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: #181818;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #3f3f3f;
            border-radius: 6px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #FF0000;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Navigation -->
    <nav class="bg-gray-900 border-b border-gray-800 px-4 py-4">
        <div class="container mx-auto flex justify-between items-center max-w-6xl">
            <div class="flex items-center gap-6">
                <a href="/" class="text-white font-bold text-xl">YouTube Transcript</a>
                <a href="/" class="text-red-500 font-semibold">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="/my-files" class="text-gray-300 hover:text-white">Ù…Ù„ÙØ§ØªÙŠ</a>
            </div>
            <a href="/logout" class="text-gray-300 hover:text-red-500">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="text-center mb-12 fade-in">
            <div class="flex justify-center mb-6">
                <div class="yt-icon">
                    <svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                    </svg>
                </div>
            </div>
            <h1 class="text-5xl font-black text-white mb-4">
                YouTube Transcript
            </h1>
            <p class="text-xl text-gray-300 mb-6">
                Ø­ÙˆÙ‘Ù„ Ø£ÙŠ ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨ Ø¥Ù„Ù‰ Ù†Øµ Ù…ÙƒØªÙˆØ¨ Ù…Ø¹ Ù…Ù„Ø®Øµ Ø°ÙƒÙŠ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
            </p>
            <div class="flex justify-center gap-3 flex-wrap">
                <span class="badge">AI Powered</span>
                <span class="badge">Ù…Ø¬Ø§Ù†ÙŠ 100%</span>
                <span class="badge">Ø³Ø±ÙŠØ¹ ÙˆØ¯Ù‚ÙŠÙ‚</span>
            </div>
        </header>

        <!-- Input Form -->
        <div class="card rounded-2xl p-8 mb-8 slide-in">
            <form id="transcriptForm">
                <label class="block text-white font-bold mb-4 text-lg">
                    Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ù† YouTube
                </label>
                <div class="flex gap-3 flex-col sm:flex-row">
                    <input 
                        type="text" 
                        id="videoUrl" 
                        placeholder="https://www.youtube.com/watch?v=..."
                        class="flex-1 px-5 py-4 rounded-lg text-lg font-medium"
                        required
                    >
                    <button 
                        type="submit"
                        class="youtube-btn text-white font-bold py-4 px-8 rounded-lg text-lg whitespace-nowrap"
                    >
                        Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªÙØ±ÙŠØº
                    </button>
                </div>
                <p id="errorMsg" class="mt-3 text-sm text-red-400 font-semibold hidden"></p>
            </form>
        </div>

        <!-- Loading -->
        <div id="loading" class="hidden card rounded-2xl p-12 text-center fade-in">
            <div class="loading-spinner mx-auto mb-6"></div>
            <h3 class="text-2xl font-bold text-white mb-2">Ø¬Ø§Ø±ÙŠ ØªÙØ±ÙŠØº Ø§Ù„Ù…Ø­ØªÙˆÙ‰...</h3>
            <p class="text-gray-300">Ù‚Ø¯ ØªØ³ØªØºØ±Ù‚ Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ø¶Ø¹ Ø¯Ù‚Ø§Ø¦Ù‚</p>
        </div>

        <!-- Results -->
        <div id="results" class="hidden space-y-6 fade-in">
            <!-- Video Info -->
            <div class="card rounded-2xl p-6">
                <div class="flex items-start gap-4">
                    <div class="w-14 h-14 youtube-red rounded-lg flex items-center justify-center flex-shrink-0">
                        <svg class="w-7 h-7 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <h2 id="videoTitle" class="text-2xl font-bold text-white mb-3 leading-relaxed"></h2>
                        <a id="videoLink" href="#" target="_blank" class="inline-flex items-center gap-2 text-red-500 hover:text-red-400 font-semibold transition-colors text-base">
                            <span>Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¹Ù„Ù‰ YouTube</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Summary -->
            <div class="card rounded-2xl p-6">
                <h3 class="section-title">Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø°ÙƒÙŠ</h3>
                
                <div id="introduction" class="content-box mb-4 hidden">
                    <h4 class="text-red-500 font-bold mb-2 text-lg">Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©</h4>
                    <div class="text-gray-100"></div>
                </div>

                <div id="summary" class="content-box mb-4 hidden">
                    <h4 class="text-red-500 font-bold mb-2 text-lg">Ø§Ù„Ù…Ù„Ø®Øµ</h4>
                    <div class="text-gray-100"></div>
                </div>

                <div id="mainPoints" class="content-box hidden">
                    <h4 class="text-red-500 font-bold mb-2 text-lg">Ø£Ù‡Ù… Ø§Ù„Ù†Ù‚Ø§Ø·</h4>
                    <div class="text-gray-100"></div>
                </div>
            </div>

            <!-- Full Content -->
            <div class="card rounded-2xl p-6">
                <button id="toggleContent" class="w-full text-right flex items-center justify-between hover:bg-gray-700/50 -m-6 p-6 rounded-2xl transition-colors">
                    <h3 class="section-title mb-0">Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙƒØ§Ù…Ù„</h3>
                    <span id="toggleIcon" class="text-2xl text-gray-300">â–¼</span>
                </button>
                <div id="fullContent" class="hidden mt-6 pt-6 border-t border-gray-700">
                    <div class="content-box max-h-96 overflow-y-auto">
                        <div class="text-gray-100 whitespace-pre-wrap"></div>
                    </div>
                </div>
            </div>

            <!-- Export Note -->
            <div class="text-center mt-8">
                <p class="text-gray-400 text-sm">
                    ğŸ’¡ Ù„ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡Ø§ Ù…Ù† Ù‚Ø³Ù… 
                    <a href="/my-files" class="text-red-500 hover:text-red-400 font-semibold">Ù…Ù„ÙØ§ØªÙŠ</a>
                </p>
            </div>

            <!-- ChatBot -->
            <div class="card rounded-2xl p-6 mt-6">
                <h3 class="section-title mb-4">ğŸ’¬ Ù†Ø§Ù‚Ø´ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h3>
                
                <!-- Chat Messages -->
                <div id="chatMessages" class="content-box mb-4 max-h-96 overflow-y-auto space-y-3">
                    <div class="text-gray-300 text-center py-8">
                        <svg class="w-12 h-12 mx-auto mb-3 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                        </svg>
                        <p>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ§Ø³Ø£Ù„ Ø£ÙŠ Ø³Ø¤Ø§Ù„ Ø¹Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</p>
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="flex gap-3">
                    <input 
                        type="text" 
                        id="chatInput" 
                        placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..."
                        class="flex-1 px-4 py-3 rounded-lg text-base"
                        onkeypress="if(event.key === 'Enter') sendMessage()"
                    >
                    <button 
                        onclick="sendMessage()"
                        class="youtube-btn text-white font-bold py-3 px-6 rounded-lg flex items-center gap-2"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                        </svg>
                        <span>Ø¥Ø±Ø³Ø§Ù„</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-12 text-gray-500 text-sm">
            <p>ØµÙÙ†Ø¹ Ø¨Ø¥ØªÙ‚Ø§Ù† Â© 2025</p>
        </footer>
    </div>

    <script>
        let currentData = null;

        document.getElementById('transcriptForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const url = document.getElementById('videoUrl').value.trim();
            const errorMsg = document.getElementById('errorMsg');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            
            // Validate YouTube URL
            const youtubeRegex = /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+$/;
            if (!youtubeRegex.test(url)) {
                errorMsg.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ ØµØ­ÙŠØ­';
                errorMsg.classList.remove('hidden');
                return;
            }
            
            errorMsg.classList.add('hidden');
            loading.classList.remove('hidden');
            results.classList.add('hidden');
            
            try {
                console.log('Sending URL:', url);
                
                const response = await fetch('/api/transcript', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url })
                });
                
                console.log('Response status:', response.status);
                
                let data = await response.json();
                console.log('Response data:', data);
                
                if (!response.ok) {
                    throw new Error(data.error || 'ÙØ´Ù„ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨');
                }
                
                // n8n returns array, get first item
                if (Array.isArray(data) && data.length > 0) {
                    data = data[0];
                }
                
                console.log('Processed data:', data);
                currentData = data;
                displayResults(data);
                
            } catch (error) {
                console.error('Error:', error);
                errorMsg.textContent = error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ';
                errorMsg.classList.remove('hidden');
            } finally {
                loading.classList.add('hidden');
            }
        });

        function displayResults(data) {
            const results = document.getElementById('results');
            
            // Video info
            const title = data.videoTitle || data.output?.subject || data.title || 'ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨';
            document.getElementById('videoTitle').textContent = title;
            
            // Set video link dynamically
            const videoUrl = data.videoUrl || data.url || document.getElementById('videoUrl').value.trim();
            const videoLinkElement = document.getElementById('videoLink');
            if (videoUrl) {
                videoLinkElement.href = videoUrl;
                videoLinkElement.classList.remove('hidden');
            } else {
                videoLinkElement.classList.add('hidden');
            }
            
            // Introduction
            const introduction = data.introduction || data.output?.introduction;
            if (introduction) {
                const intro = document.getElementById('introduction');
                const introDiv = intro.querySelector('div');
                // Format with better line breaks
                introDiv.innerHTML = introduction.replace(/\n/g, '<br><br>');
                intro.classList.remove('hidden');
            }
            
            // Summary
            const summary = data.summary;
            if (summary) {
                const summaryEl = document.getElementById('summary');
                const summaryDiv = summaryEl.querySelector('div');
                // Format with better line breaks
                summaryDiv.innerHTML = summary.replace(/\n/g, '<br><br>');
                summaryEl.classList.remove('hidden');
            }
            
            // Main Points
            const mainPoints = data.mainPoints;
            if (mainPoints) {
                const points = document.getElementById('mainPoints');
                const pointsDiv = points.querySelector('div');
                // Format points with better structure
                let formattedPoints = mainPoints;
                // Add spacing between points
                formattedPoints = formattedPoints.replace(/\n/g, '<br>');
                // Make numbered/bulleted points stand out
                formattedPoints = formattedPoints.replace(/^(\d+[\.\-)]|[â€¢\-\*])/gm, '<strong style="color: #FF0000;">$1</strong>');
                pointsDiv.innerHTML = formattedPoints;
                points.classList.remove('hidden');
            }
            
            // Full Content
            const fullContent = data.fullContent || data.fullcontent;
            if (fullContent) {
                const fullContentDiv = document.querySelector('#fullContent div div');
                // Format with proper line breaks
                fullContentDiv.innerHTML = fullContent.replace(/\n/g, '<br>');
            }
            
            // Show results with animation
            results.classList.remove('hidden');
            results.style.animation = 'fadeIn 0.6s ease-out';
        }

        // Toggle full content
        document.getElementById('toggleContent').addEventListener('click', () => {
            const content = document.getElementById('fullContent');
            const icon = document.getElementById('toggleIcon');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.textContent = 'â–²';
            } else {
                content.classList.add('hidden');
                icon.textContent = 'â–¼';
            }
        });

        // Export functions removed - Ø§Ù„ØªØµØ¯ÙŠØ± Ù…ØªØ§Ø­ ÙÙ‚Ø· Ù…Ù† Ù‚Ø³Ù… "Ù…Ù„ÙØ§ØªÙŠ"

        // ChatBot Functions
        let chatSessionId = null;

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Clear input
            input.value = '';
            
            // Add user message to chat
            addMessageToChat('user', message);
            
            // Show typing indicator
            const typingId = addMessageToChat('bot', '...', true);
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        message: message,
                        sessionId: chatSessionId
                    })
                });
                
                const data = await response.json();
                console.log('Chat response:', data);
                
                // Remove typing indicator
                document.getElementById(typingId).remove();
                
                if (response.ok) {
                    // Update session ID if provided
                    if (data.sessionId) {
                        chatSessionId = data.sessionId;
                    }
                    
                    // Add bot response - n8n chat returns {output: "message"}
                    const botMessage = data.output || data.response || data.message || 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø¯';
                    
                    if (botMessage && botMessage.trim()) {
                        addMessageToChat('bot', botMessage);
                    } else {
                        addMessageToChat('bot', 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø¯ Ù…Ù†Ø§Ø³Ø¨');
                    }
                } else {
                    const errorMsg = data.error || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø§Øª Ø¨ÙˆØª';
                    addMessageToChat('bot', `Ø¹Ø°Ø±Ø§Ù‹ØŒ ${errorMsg}`);
                }
                
            } catch (error) {
                console.error('Chat error:', error);
                document.getElementById(typingId).remove();
                addMessageToChat('bot', 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
            }
        }

        function addMessageToChat(type, message, isTyping = false) {
            const messagesContainer = document.getElementById('chatMessages');
            
            // Remove welcome message if exists
            const welcome = messagesContainer.querySelector('.text-center');
            if (welcome) {
                welcome.remove();
            }
            
            const messageId = 'msg-' + Date.now();
            const messageDiv = document.createElement('div');
            messageDiv.id = messageId;
            messageDiv.className = `flex ${type === 'user' ? 'justify-end' : 'justify-start'}`;
            
            const bubbleClass = type === 'user' 
                ? 'bg-red-600 text-white' 
                : 'bg-gray-700 text-gray-200';
            
            messageDiv.innerHTML = `
                <div class="${bubbleClass} rounded-2xl px-4 py-3 max-w-[80%] ${isTyping ? 'animate-pulse' : ''}">
                    <p class="text-sm leading-relaxed whitespace-pre-wrap">${message}</p>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            return messageId;
        }
    </script>
</body>
</html>
